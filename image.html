<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title> Image Generator</title>
</head>
<body>
    <h1>Horde Image Generator</h1>

    <label>Prompt:</label><br>
    <input id="prompt" type="text" size="60" value="a futuristic city at sunset"><br><br>

    <button onclick="generate()">Generate Image</button>

    <h2>Status</h2>
    <pre id="status"></pre>

    <h2>Image</h2>
    <img id="resultImage" style="max-width:512px">

    <script>
        const API_URL = "https://praterich.vercel.app/api/image";

        async function generate() {
            const prompt = document.getElementById("prompt").value;
            document.getElementById("status").textContent = "Submitting request...";

            const response = await fetch(API_URL, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ prompt })
            });

            const data = await response.json();
            document.getElementById("status").textContent = "ID: " + data.id;

            let done = false;
            while (!done) {
                const checkRes = await fetch(API_URL + "?id=" + data.id);
                const info = await checkRes.json();

                document.getElementById("status").textContent =
                    JSON.stringify(info, null, 2);

                if (info.done && info.generations) {
                    const url = info.generations[0].img;
                    document.getElementById("resultImage").src = url;
                    done = true;
                }

                await new Promise(r => setTimeout(r, 1500));
            }
        }
    </script>
</body>
</html>
